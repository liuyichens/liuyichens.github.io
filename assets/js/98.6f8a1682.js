(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{584:function(t,a,s){"use strict";s.r(a);var e=s(31),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"网页的解析过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网页的解析过程"}},[t._v("#")]),t._v(" 网页的解析过程")]),t._v(" "),s("p",[t._v("用户在浏览器输入域名 --\x3e DNS服务器解析出具体IP --\x3e 发送请求到对应的服务器 --\x3e 服务器返回响应的静态资源 --\x3e  客户端下载静态资源(index.html) --\x3e 遇到link元素css文件 --\x3e 下载css文件")]),t._v(" "),s("p",[t._v("​\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t--\x3e 遇到script元素 --\x3e 下载js文件")]),t._v(" "),s("h2",{attrs:{id:"浏览器的渲染流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器的渲染流程"}},[t._v("#")]),t._v(" 浏览器的渲染流程")]),t._v(" "),s("h3",{attrs:{id:"浏览器内核"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器内核"}},[t._v("#")]),t._v(" 浏览器内核")]),t._v(" "),s("p",[t._v("浏览器内核也称为排版引擎，网页通过排版引擎进行渲染")]),t._v(" "),s("h3",{attrs:{id:"浏览器渲染页面的详细流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器渲染页面的详细流程"}},[t._v("#")]),t._v(" 浏览器渲染页面的详细流程")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/liuyichens/blog_img@main/image.3smoqoyg2ku0.webp",alt:"image"}})]),t._v(" "),s("h4",{attrs:{id:"解析一-html解析过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解析一-html解析过程"}},[t._v("#")]),t._v(" 解析一  HTML解析过程")]),t._v(" "),s("p",[t._v("默认情况下服务器会给浏览器返回index.html文件，所以解析HTML是所有步骤的开始；")]),t._v(" "),s("p",[t._v("解析HTML会构建"),s("code",[t._v("DOM Tree")])]),t._v(" "),s("h4",{attrs:{id:"解析二-生成css规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解析二-生成css规则"}},[t._v("#")]),t._v(" 解析二  生成CSS规则")]),t._v(" "),s("p",[t._v("在解析的过程中，如果遇到CSS的link元素，那么会由浏览器负责下载对应的CSS文件("),s("strong",[t._v("注意：下载CSS文件是不会影响DOM的解析的")]),t._v(")")]),t._v(" "),s("p",[t._v("浏览器下载完CSS文件后，就会对CSS文件进行解析，"),s("strong",[t._v("解析出对应规则树")]),t._v("，可以称之为"),s("code",[t._v("CSSOM(CSS Object Model)")])]),t._v(" "),s("h4",{attrs:{id:"解析三-构建render-tree"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解析三-构建render-tree"}},[t._v("#")]),t._v(" 解析三   构建Render Tree")]),t._v(" "),s("p",[t._v("当有了DOM Tree和CSSOM Tree后就可以两个结合来构建"),s("strong",[t._v("Render Tree")]),t._v("了")]),t._v(" "),s("blockquote",[s("p",[t._v("注意")])]),t._v(" "),s("ul",[s("li",[t._v("link元素不会阻塞"),s("code",[t._v("DOM Tree")]),t._v("的构建过程，但是会阻塞"),s("code",[t._v("Render Tree")]),t._v("的构建过程；这是因为Render Tree在构建时，需要对应的CSSOM Tree")]),t._v(" "),s("li",[t._v("Render Tree和DOM Tree并不是一一对应的关系，比如对于display为none的元素，压根不会出现在Render Tree中")])]),t._v(" "),s("h4",{attrs:{id:"解析四-布局-layout-和绘制-paint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解析四-布局-layout-和绘制-paint"}},[t._v("#")]),t._v(" 解析四   布局(layout)和绘制(paint)")]),t._v(" "),s("p",[t._v("第四步是在渲染树上运行布局以计算每个节点的几何体")]),t._v(" "),s("p",[t._v("​\t渲染树会表示显示哪些节点以及其他样式，但是不表示每个节点的尺寸、位置等信息")]),t._v(" "),s("p",[t._v("​\t布局是确定呈现树中所有节点的宽度、高度和位置信息")]),t._v(" "),s("p",[t._v("第五步是将每个节点绘制到屏幕上")]),t._v(" "),s("p",[t._v("​\t在绘制阶段，浏览器将布局阶段计算的每个frame转为屏幕上实际的像素点")]),t._v(" "),s("p",[t._v("​\t包括将元素的可见部分进行绘制，比如文本、颜色、边框、阴影、替换元素")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/liuyichens/blog_img@main/image.744a8cbrcog0.webp",alt:"image"}})]),t._v(" "),s("h2",{attrs:{id:"回流和重绘解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回流和重绘解析"}},[t._v("#")]),t._v(" 回流和重绘解析")]),t._v(" "),s("h3",{attrs:{id:"回流-reflow"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回流-reflow"}},[t._v("#")]),t._v(" 回流(reflow)")]),t._v(" "),s("ul",[s("li",[t._v("回流也称为重排")]),t._v(" "),s("li",[t._v("第一次确定节点的大小和位置，称之为布局")]),t._v(" "),s("li",[t._v("之后对节点的大小、位置修改重新计算称之为回流")])]),t._v(" "),s("h4",{attrs:{id:"引起回流的情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引起回流的情况"}},[t._v("#")]),t._v(" 引起回流的情况")]),t._v(" "),s("ul",[s("li",[t._v("DOM结构发生改变(添加新的节点或者移除节点)")]),t._v(" "),s("li",[t._v("改变了布局(修改了width、height、padding、font-size等)")]),t._v(" "),s("li",[t._v("修改了窗口resize(修改了窗口的尺寸等)")]),t._v(" "),s("li",[t._v("调用"),s("code",[t._v("getComputedStyle")]),t._v("方法获取尺寸、位置信息")])]),t._v(" "),s("h3",{attrs:{id:"重绘-repaint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重绘-repaint"}},[t._v("#")]),t._v(" 重绘（repaint）")]),t._v(" "),s("ul",[s("li",[t._v("第一次渲染内容称之为绘制")]),t._v(" "),s("li",[t._v("之后的重新渲染称之为重绘")])]),t._v(" "),s("h4",{attrs:{id:"引起重绘的情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引起重绘的情况"}},[t._v("#")]),t._v(" 引起重绘的情况")]),t._v(" "),s("ul",[s("li",[t._v("修改背景色、文字颜色、边框颜色、样式等")])]),t._v(" "),s("h3",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("ul",[s("li",[t._v("回流一定会引起重绘，所以回流是一件很消耗性能的事情，因此在开发中要尽量避免发生回流")]),t._v(" "),s("li",[t._v("修改样式时尽量一次性修改，比如通过"),s("code",[t._v("cssText")]),t._v("修改，比如通过class修改")]),t._v(" "),s("li",[t._v("尽量避免频繁的操作DOM，可以在一个DocumentFragement或者父元素中将要操作的DOM完成，再一次性执行")]),t._v(" "),s("li",[t._v("尽量避免使用"),s("code",[t._v("getComputedStyle")]),t._v("获取尺寸、位置等信息")]),t._v(" "),s("li",[s("strong",[t._v("对某些元素使用position或者fixed")]),t._v("，并不是不会引起回流，而是开销相对较小，不会对其它元素造成影响。")])]),t._v(" "),s("h2",{attrs:{id:"合成和性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#合成和性能优化"}},[t._v("#")]),t._v(" 合成和性能优化")]),t._v(" "),s("h3",{attrs:{id:"特殊解析-composite合成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特殊解析-composite合成"}},[t._v("#")]),t._v(" 特殊解析 --- composite合成")]),t._v(" "),s("p",[t._v("绘制过程中，可以将布局后的元素绘制到多个合成图层中，这是浏览器的一种优化手段。")]),t._v(" "),s("p",[t._v("默认情况下，标准流中的内容都是被绘制在同一个图层中的。")]),t._v(" "),s("p",[t._v("一些特殊的属性会创建一个新的合成图层，并且新的图层可以利用GPU来加速绘制，因为每个合成图层都是单独渲染的")]),t._v(" "),s("blockquote",[s("p",[t._v("常见的可以形成新的合成层的属性")])]),t._v(" "),s("ul",[s("li",[t._v("3D transforms  必须是3D")]),t._v(" "),s("li",[t._v("video、canvas、iframe.")]),t._v(" "),s("li",[t._v("opacity 动画转换")]),t._v(" "),s("li",[t._v("position: fixed")]),t._v(" "),s("li",[t._v("will-change:  一个实验性的属性，提前告诉浏览器元素可能发生哪些变化")]),t._v(" "),s("li",[t._v("animation或transition设置了opacity、transform")])]),t._v(" "),s("blockquote",[s("p",[t._v("分层确实可以提高性能，但是它是以内存管理为代价，因此不应作为web性能优化策略的一部分而过度使用")])]),t._v(" "),s("h2",{attrs:{id:"defer和async属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#defer和async属性"}},[t._v("#")]),t._v(" defer和async属性")]),t._v(" "),s("h3",{attrs:{id:"script元素和页面解析的关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#script元素和页面解析的关系"}},[t._v("#")]),t._v(" script元素和页面解析的关系")]),t._v(" "),s("h4",{attrs:{id:"页面渲染过程中-javascript如何执行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#页面渲染过程中-javascript如何执行"}},[t._v("#")]),t._v(" 页面渲染过程中，JavaScript如何执行")]),t._v(" "),s("ul",[s("li",[t._v("浏览器解析HTML的过程中，遇到了script元素是不能继续构建DOM树的。")]),t._v(" "),s("li",[t._v("它会停止继续构建，首先下载JavaScript代码，并且执行JavaScript的脚本")]),t._v(" "),s("li",[t._v("只有等到JavaScript脚本执行结束后，才会继续解析HTML，构建DOM树")])]),t._v(" "),s("h4",{attrs:{id:"以这种形式渲染的原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#以这种形式渲染的原因"}},[t._v("#")]),t._v(" 以这种形式渲染的原因")]),t._v(" "),s("ul",[s("li",[t._v("JavaScript的作用之一就是操作DOM，并且可能会修改DOM")]),t._v(" "),s("li",[t._v("如果等到DOM树构建完成并且渲染再执行JavaScript，会造成严重的回流和重绘，影响页面性能")]),t._v(" "),s("li",[t._v("在遇到script元素时，优先下载JavaScript代码，再继续构建DOM树")])]),t._v(" "),s("h4",{attrs:{id:"产生的新问题-特别是在现代页面开发中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#产生的新问题-特别是在现代页面开发中"}},[t._v("#")]),t._v(" 产生的新问题，特别是在现代页面开发中")]),t._v(" "),s("ul",[s("li",[t._v("在目前的开发模式中(Vue, React)，脚本往往比HTML页面更重，处理时间更长")]),t._v(" "),s("li",[t._v("所以会造成页面的解析阻塞，在脚本下载、执行完成之前，用户在界面上什么都看不到。")])]),t._v(" "),s("blockquote",[s("p",[t._v("为了解决上面的问题，script元素提供了两个属性(attribute)  "),s("strong",[t._v("defer")]),t._v("和"),s("strong",[t._v("async")])])]),t._v(" "),s("h3",{attrs:{id:"defer属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#defer属性"}},[t._v("#")]),t._v(" defer属性")]),t._v(" "),s("p",[t._v("defer属性告诉浏览器不要等待脚本下载，而是继续解析HTML，构建DOM Tree")]),t._v(" "),s("ul",[s("li",[t._v("脚本会由浏览器来进行下载，但是不会阻塞DOM Tree的构建过程")]),t._v(" "),s("li",[t._v("如果脚本已经提前下载好了，会等待 DOM Tree构建完成，即在执行defer中的代码时，DOM Tree已经构建完成了；在DOMContentLoaded事件之前先执行defer中的代码")])]),t._v(" "),s("p",[t._v("因此DOMContentLoaded总是会等待defer中的代码先执行完成")]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./test.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("defer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n\twindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOMContentLoaded"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOMContentLoaded"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("多个带"),s("code",[t._v("defer")]),t._v("属性的脚本是可以保持正确顺序执行的")]),t._v(" "),s("p",[t._v("从某种角度来说，defer属性可以提高页面的性能，并且推荐放到head 元素中")]),t._v(" "),s("p",[s("strong",[t._v("defer仅适用于外部脚本，对于script默认内容会被忽略")])]),t._v(" "),s("h3",{attrs:{id:"async属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#async属性"}},[t._v("#")]),t._v(" async属性")]),t._v(" "),s("p",[t._v("async属性和defer有些类似，也能够让脚本不阻塞页面渲染。")]),t._v(" "),s("p",[t._v("async是让一个脚本完全独立的")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("浏览器不会因async脚本而阻塞(同defer类似)")])]),t._v(" "),s("li",[s("p",[t._v("async脚本不能保证顺序，它是独立下载、独立运单，不会等待其它脚本")])]),t._v(" "),s("li",[s("p",[t._v("async不会能保证在DOMContentLoaded之前或之后执行")]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n\twindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DOMContentLoaded'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DOMContentLoaded'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/test.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("defer属性通常用于需要在文档脚本解析后操作DOM的JavaScript代码，并且对多个script文件有顺序要求")])]),t._v(" "),s("li",[s("p",[t._v("async通常用于独立的脚本，对其他脚本甚至DOM是没有依赖的。")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);